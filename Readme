
SIMULATION
1.) Welt
roslaunch match_gazebo world_match.launch

2.) Roboter
-> Simulation:
roslaunch mir_launch_sim mir.launch
-> Hardware:
roslaunch mir_launch_hardware mir.launch

3.) Application
roslaunch detection_localisation DetectionServer.launch
roslaunch detection_localisation DetectionClient.launch



********************************************************************
VORGEHEN LERNEN
1.) 
roslaunch learn_object pose_teacher.launch
! Launchfile auf Hardware vs Simulation anpassen

Hardware: Navigiere Robo mit ps4 Controller zur ersten Suchpose, sodass Objekt gut sichtbar in Camera ist -> X
Simulation: position in rviz über navgoal vorgeben und speichern mit:
rosservice call /pose_teacher/save_pose_unnamed "{}" 

2.) 
roslaunch learn_object calculate_learnposes.launch

Berechne weitere Lernposen und speicher diese in .yaml file
Testen der erzeugten Posen in Simulation über:
rostopic pub /move_base/goal move_base_msgs/MoveBaseActionGoal "header:
  seq: 0
  stamp:
    secs: 0
    nsecs: 0
  frame_id: ''
goal_id:
  stamp:
    secs: 0
    nsecs: 0
  id: ''
goal:
  target_pose:
    header:
      seq: 0
      stamp:
        secs: 0
        nsecs: 0
      frame_id: 'map'
    pose:
      position:
        x: 0.0
        y: 0.0
        z: 0.0
      orientation:
        x: 0.0
        y: 0.0
        z: 0.0
        w: 1" 

rostopic pub /move_base/goal move_base_msgs/MoveBaseActionGoal "header:
  seq: 0
  stamp:
    secs: 0
    nsecs: 0
  frame_id: ''
goal_id:
  stamp:
    secs: 0
    nsecs: 0
  id: ''
goal:
  target_pose:
    header:
      seq: 0
      stamp:
        secs: 0
        nsecs: 0
      frame_id: 'map'
    pose:
      position:
        x: 2.0086488221320598
        y: 2.021197038091382
        z: 0.0
      orientation:
        x: 0.0
        y: 0.0
        z: -0.696273668817634
        w: 0.7177764123396868"
BESSER
rostopic echo /move_base_simple/goal
-> Message kopieren um sie dann für die folgenden Messreihen zu nutzen
header: 
  seq: 20
  stamp: 
    secs: 1617298953
    nsecs: 298528457
  frame_id: "map"
pose: 
  position: 
    x: 7.52769088745
    y: 21.3555850983
    z: 0.0
  orientation: 
    x: 0.0
    y: 0.0
    z: -0.000838605297691
    w: 0.999999648371
---

roslaunch helper calculate_poses.launch target:="Goesser_35_98_" radius:="1.15"
roslaunch helper publish_poses.launch filename:="poses_circular.yaml" topic:="/cam" target:="Goesser_35_98_"
roslaunch helper publish_poses.launch filename:="poses_circular_base.yaml" target:="Goesser_35_98_"

rostopic pub /move_base_simple/goal geometry_msgs/PoseStamped "header:
  seq: 0
  stamp:
    secs: 0
    nsecs: 0
  frame_id: "map"
pose: 
  position: 
    x: 7.52769088745
    y: 21.3555850983
    z: 0.0
  orientation: 
    x: 0.0
    y: 0.0
    z: -0.000838605297691
    w: 0.999999648371"

roslaunch learn_object take_learnphotos.launch object:="Goesser_35_98_"

3.)
roslaunch learn_object take_learnphotos.launch

Automatische Navigation des Robos zu den berechneten Posen und Fotos aufnehmen

roslaunch learn_object take_learnphotos.launch filename_poses:="poses_circular_base.yaml" path:="/home/rosmatch/catkin_ws_D435/src/object_localisation_d435/detection_localisation/poses"
roslaunch helper publish_poses.launch filename:="poses_circular_base.yaml" 


4)

Manually initialise the photos by clicking the 4 corners of the model

5)
# calculate linear poses
roslaunch helper publish_poses.launch filename:="poses_circular.yaml" topic:="/cam"
roslaunch helper publish_poses.launch filename:="poses_circular_base.yaml" 
roslaunch helper calculate_poses.launch 

rostopic echo /targetMarker -n 1
header: 
  seq: 261
  stamp: 
    secs: 0
    nsecs:         0
  frame_id: "map"
ns: ''
id: 0
type: 1
action: 0
pose: 
  position: 
    x: 7.540143013
    y: 21.3822193146
    z: 0.15
  orientation: 
    x: 0.0
    y: 0.0
    z: 0.00654810830359
    w: 0.999978560909
scale: 
  x: 0.4
  y: 0.3
  z: 0.3
color: 
  r: 0.0
  g: 0.0
  b: 0.0
  a: 0.5
lifetime: 
  secs: 0
  nsecs:         0
frame_locked: False
points: []
colors: []
text: ''
mesh_resource: ''
mesh_use_embedded_materials: False
---

7)
Check  how Keypoints change ober x images from one pose:
a) take photos
roslaunch learn_object take_learnphotos.launch object:="Goesser_35_63_" folderSave:="static/" numberImages:="20" 
b) learn keypoints
roslaunch learn_object learn_keypoints.launch model:="Goesser" object:="Goesser_35_63_"

8) display Image Stack
roslaunch helper display_images.launch 

*****************************************************************************************+
ROSBAG 

mkdir ~/bagfiles
cd ~/bagfiles
rosbag record -a
# -a = record all topics

rosbag record -O subset /turtle1/cmd_vel /turtle1/pose
# record only the 2 topics

rosbag info <your bagfile>
rosbag play <your bagfile>


+++++++++++++++++++++++++++++++++++++++++
1:
  header:
    frame_id: map
  pose:
    orientation:
      w: 0.9999128994664781
      x: 0.0
      y: 0.0
      z: -0.013198237781643868
    position:
      x: 5.965186037579429
      y: 21.417526222220065
      z: 0.0
2:
  header:
    frame_id: map
  pose:
    orientation:
      w: 0.7699310782537114
      x: 0.0
      y: 0.0
      z: -0.6381270521918636
    position:
      x: 8.213358310608807
      y: 22.240972388379365
      z: 0.0
3:
  header:
    frame_id: map
  pose:
    orientation:
      w: -0.0931995206160208
      x: 0.0
      y: 0.0
      z: 0.9956474523429184
    position:
      x: 9.276434351213325
      y: 21.515666017324605
      z: 0.0

Rechnung 2
1:
  header:
    frame_id: base_link
  pose:
    orientation:
      w: 0.999988639269465
      x: 0.0
      y: 0.0
      z: -0.004766689837174855
    position:
      x: 5.909273962475611
      y: 21.412878667329398
      z: 0.0
2:
  header:
    frame_id: base_link
  pose:
    orientation:
      w: 0.7071067811865476
      x: 0.0
      y: 0.0
      z: -0.7071067811865475
    position:
      x: 1.21
      y: 1.11
      z: 0.0
3:
  header:
    frame_id: base_link
  pose:
    orientation:
      w: -6.123233995736766e-17
      x: 0.0
      y: 0.0
      z: 1.0
    position:
      x: 2.12
      y: 0.20000000000000012
      z: 0.0



c)

1:
  header:
    frame_id: map
  pose:
    orientation:
      w: 0.9999782024761222
      x: 0.0
      y: 0.0
      z: 0.006602618618658114
    position:
      x: 6.013370836243981
      y: 21.416009086237725
      z: 0.0
2:
  header:
    frame_id: map
  pose:
    orientation:
      w: 0.7117601244084423
      x: 0.0
      y: 0.0
      z: -0.7024226116107587
    position:
      x: 7.184912201500916
      y: 22.821601783106885
      z: 0.0
3:
  header:
    frame_id: map
  pose:
    orientation:
      w: -0.006602618618658175
      x: 0.0
      y: 0.0
      z: 0.9999782024761222
    position:
      x: 8.387881346319956
      y: 21.847401990141734
      z: 0.0









 
